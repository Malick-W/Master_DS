<!DOCTYPE html><html lang="en">  <head>    <meta charset="utf-8">    <meta name="viewport" content="width=device-width, initial-scale=1.0">    <title>Untitled :: Master Data Science 2</title>    <link rel="canonical" href="https://math.univ-angers.fr/~jaclin/2020ds2ue4/python_parallelisme/2020/aiohttp/collecte.html">    <meta name="generator" content="Antora 2.0.0">    <link rel="stylesheet" href="../../../_/css/site.css">  </head>  <body class="article"><header class="header">  <nav class="navbar">    <div class="navbar-brand">      <a class="navbar-item" href="https://math.univ-angers.fr/~jaclin/2020ds2ue4">Master Data Science 2</a>      <button class="navbar-burger" data-target="topbar-nav">        <span></span>        <span></span>        <span></span>      </button>    </div>    <div id="topbar-nav" class="navbar-menu">    </div>  </nav></header><div class="main-wrapper"><div class="navigation-container" data-component="python_parallelisme" data-version="2020">  <aside class="navigation">    <div class="panels"><div class="navigation-menu is-active" data-panel="menu">  <nav class="nav-menu">    <h3 class="title"><a href="../main.html">Parallélisme</a></h3><ul class="nav-list">  <li class="nav-item" data-depth="0"><ul class="nav-list">  <li class="nav-item" data-depth="1">    <button class="nav-toggle"></button>    <a class="nav-link" href="../introduction/intro.html">Introduction</a><ul class="nav-list">  <li class="nav-item" data-depth="2">    <a class="nav-link" href="../introduction/intro.html#_architecture_vectorielle">architecture vectorielle</a>  </li>  <li class="nav-item" data-depth="2">    <a class="nav-link" href="../introduction/intro.html#_multi_processing">multi-processing</a>  </li>  <li class="nav-item" data-depth="2">    <a class="nav-link" href="../introduction/intro.html#_multi_threading">multi-threading</a>  </li>  <li class="nav-item" data-depth="2">    <a class="nav-link" href="../introduction/intro.html#_asynchronisme">asynchronisme</a>  </li></ul>  </li></ul>  </li>  <li class="nav-item" data-depth="0"><ul class="nav-list">  <li class="nav-item" data-depth="1">    <button class="nav-toggle"></button>    <a class="nav-link" href="../multithreading/multithread.html">Multithreading en Python</a><ul class="nav-list">  <li class="nav-item" data-depth="2">    <a class="nav-link" href="../multithreading/multithread.html#_tâche">Tâche</a>  </li>  <li class="nav-item" data-depth="2">    <a class="nav-link" href="../multithreading/multithread.html#_synchronisation">Synchronisation</a>  </li>  <li class="nav-item" data-depth="2">    <a class="nav-link" href="../multithreading/multithread.html#_atomicité">Atomicité</a>  </li>  <li class="nav-item" data-depth="2">    <a class="nav-link" href="../multithreading/multithread.html#_verrou">Verrou</a>  </li></ul>  </li></ul>  </li>  <li class="nav-item" data-depth="0"><ul class="nav-list">  <li class="nav-item" data-depth="1">    <button class="nav-toggle"></button>    <a class="nav-link" href="../asynchronisme/async.html">Asynchronisme en Python</a><ul class="nav-list">  <li class="nav-item" data-depth="2">    <a class="nav-link" href="../asynchronisme/async.html#_coroutine">Coroutine</a>  </li>  <li class="nav-item" data-depth="2">    <a class="nav-link" href="../asynchronisme/async.html#_boucle_dévènements">Boucle d&#8217;évènements</a>  </li>  <li class="nav-item" data-depth="2">    <a class="nav-link" href="../application/appli.html">Application</a>  </li></ul>  </li></ul>  </li>  <li class="nav-item" data-depth="0"><ul class="nav-list">  <li class="nav-item is-current-page" data-depth="1">    <button class="nav-toggle"></button>    <a class="nav-link" href="collecte.html">Collecte sur le web</a><ul class="nav-list">  <li class="nav-item" data-depth="2">    <a class="nav-link" href="#http">Le protocole HTTP</a>  </li>  <li class="nav-item" data-depth="2">    <a class="nav-link" href="#get">Récupérer un document</a>  </li>  <li class="nav-item" data-depth="2">    <a class="nav-link" href="#https">Le protocole HTTPS</a>  </li>  <li class="nav-item" data-depth="2">    <a class="nav-link" href="#servicesweb">Services web</a>  </li></ul>  </li>  <li class="nav-item" data-depth="1">    <button class="nav-toggle"></button>    <a class="nav-link" href="aio.html">Le module <code>aiohttp</code></a><ul class="nav-list">  <li class="nav-item" data-depth="2">    <a class="nav-link" href="aio.html#streaming">Streaming</a>  </li>  <li class="nav-item" data-depth="2">    <a class="nav-link" href="aio.html#aiofiles">Le module <code>aiofiles</code></a>  </li></ul>  </li></ul>  </li></ul>  </nav></div><div class="navigation-explore" data-panel="explore">  <div class="context">    <span class="title">Parallélisme</span>    <span class="version">2020</span>  </div>  <ul class="components">    <li class="component is-current">      <span class="title">Parallélisme</span>      <ul class="versions">        <li class="version is-current is-latest">          <a href="../main.html">2020</a>        </li>      </ul>    </li>  </ul></div>    </div>  </aside></div>  <main class="main"><div class="toolbar" role="navigation">  <button class="navigation-toggle"></button>  <a href="../main.html" class="home-link"></a><nav class="crumbs" aria-label="breadcrumbs">  <ul>    <li class="crumb"><a href="../main.html">Parallélisme</a></li>    <li class="crumb"><a href="collecte.html">Collecte sur le web</a></li>  </ul></nav></div><article class="doc"><div class="sect1"><h2 id="_collecte_sur_le_web"><a class="anchor" href="#_collecte_sur_le_web"></a>Collecte sur le web</h2><div class="sectionbody"><div class="sect2"><h3 id="http"><a class="anchor" href="#http"></a>Le protocole HTTP</h3><div class="paragraph"><p>Principe :</p></div><div class="ulist"><ul><li><p>le client HTTP ouvre une connexion sur le serveur, et lui soumet un ensemble de requêtes.</p></li><li><p>le serveur répond à chaque requête</p></li></ul></div><table class="tableblock frame-all grid-all stretch"><caption class="title">Table 1. dialogue HTTP</caption><colgroup><col style="width: 33.3333%;"><col style="width: 33.3333%;"><col style="width: 33.3334%;"></colgroup><thead><tr><th class="tableblock halign-left valign-top"></th><th class="tableblock halign-left valign-top">client</th><th class="tableblock halign-left valign-top">serveur</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class="tableblock">début de connexion</p></td><td class="tableblock halign-left valign-top"></td><td class="tableblock halign-left valign-top"></td></tr><tr><td class="tableblock halign-left valign-top"></td><td class="tableblock halign-left valign-top"><p class="tableblock">requête 1 &#8594;</p></td><td class="tableblock halign-left valign-top"></td></tr><tr><td class="tableblock halign-left valign-top"></td><td class="tableblock halign-left valign-top"></td><td class="tableblock halign-left valign-top"><p class="tableblock">&#8592; réponse 1</p></td></tr><tr><td class="tableblock halign-left valign-top"></td><td class="tableblock halign-left valign-top"><p class="tableblock">requête 2 &#8594;</p></td><td class="tableblock halign-left valign-top"></td></tr><tr><td class="tableblock halign-left valign-top"></td><td class="tableblock halign-left valign-top"></td><td class="tableblock halign-left valign-top"><p class="tableblock">&#8592; réponse 2</p></td></tr><tr><td class="tableblock halign-left valign-top"></td><td class="tableblock halign-left valign-top"><p class="tableblock">requête 3 &#8594;</p></td><td class="tableblock halign-left valign-top"></td></tr><tr><td class="tableblock halign-left valign-top"></td><td class="tableblock halign-left valign-top"></td><td class="tableblock halign-left valign-top"><p class="tableblock">&#8592; réponse 3</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">fin de connexion</p></td><td class="tableblock halign-left valign-top"></td><td class="tableblock halign-left valign-top"></td></tr></tbody></table><div class="paragraph"><p>La connexion se ferme à la demande du client, ou bien à l&#8217;initiative du serveur si le client est trop lent (timeout), incohérent ou si le nombre maximum de requêtes autorisé est dépassé.</p></div><div class="paragraph"><p>Le format d&#8217;une requête est :</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code>méthodeentete1entete2entete3dataline 1dataline 2...</code></pre></div></div><div class="listingblock"><div class="title">exemple de requête HTTP</div><div class="content"><pre class="highlightjs highlight"><code>GET http://www.univ-angers.fr/fr/index.html HTTP/1.1Host: www.univ-angers.frIf-Modified-Since: Fri, 11 Jan 2019 17:28:49 GMT(ligne vide)</code></pre></div></div><div class="listingblock"><div class="title">exemple de requête avec un body</div><div class="content"><pre class="highlightjs highlight"><code>POST /path/script.cgi HTTP/1.0From: frog@jmarshall.comUser-Agent: HTTPTool/1.0Content-Type: application/x-www-form-urlencodedContent-Length: 32home=Cosbyfavorite=flies</code></pre></div></div><div class="paragraph"><p>La format d&#8217;une réponse est :</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code>statusentete1entete2entete3dataline 1dataline 2dataline 3dataline 4...</code></pre></div></div><div class="listingblock"><div class="title">exemple de réponse</div><div class="content"><pre class="highlightjs highlight"><code>HTTP/1.1 200Date: Sun, 18 Aug 2019 09:07:03 GMTServer: Apache/2.4.29 (Ubuntu)X-Cocoon-Version: 2.1.13-devAccept-Ranges: bytesLast-Modified: Sun, 18 Aug 2019 08:00:31 GMTContent-Type: text/html; charset=UTF-8Content-Length: 63914Vary: Accept-EncodingCache-Control: max-age=1Expires: Sun, 18 Aug 2019 09:07:03 GMTContent-Language: fr&lt;!DOCTYPE html&gt;...</code></pre></div></div><table class="tableblock frame-all grid-all stretch"><caption class="title">Table 2. Codes de retour HTTP</caption><colgroup><col style="width: 50%;"><col style="width: 50%;"></colgroup><thead><tr><th class="tableblock halign-center valign-top" colspan="2">1xx - information</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">continue</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">102</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">processing</p></td></tr><tr><td class="tableblock halign-center valign-top" colspan="2"><p class="tableblock"><strong>2xx</strong> - <strong>succès</strong></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">OK</p></td></tr><tr><td class="tableblock halign-center valign-top" colspan="2"><p class="tableblock"><strong>3xx</strong> - <strong>redirection</strong></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">301</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">moved permanently</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">307</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">temporary redirect</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">308</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">permanent redirect</p></td></tr><tr><td class="tableblock halign-center valign-top" colspan="2"><p class="tableblock"><strong>4xx</strong> - <strong>erreur coté client</strong></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">403</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">forbidden</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">not found</p></td></tr><tr><td class="tableblock halign-center valign-top" colspan="2"><p class="tableblock"><strong>5xx</strong> - <strong>erreur coté serveur</strong></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">500</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">internal server error</p></td></tr></tbody></table></div><div class="sect2"><h3 id="get"><a class="anchor" href="#get"></a>Récupérer un document sur le web</h3><div class="sect3"><h4 id="_wget"><a class="anchor" href="#_wget"></a><code>wget</code></h4><div class="paragraph"><p>Beaucoup de commandes Unix permettent de soumettre manuellement des requêtes HTTP : <code>wget</code>, <code>curl</code>, etc.</p></div><div class="paragraph"><p><code>wget</code>, l&#8217;un d&#8217;elle, est le <em>couteau suisse</em> des requêteurs :elle peut récupérer une page, une page et ses composantes (images, css, etc.), un site complet, un ensemble de sites auto-référencés, etc.</p></div><div class="listingblock"><div class="title">exemple</div><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ wget -p https://math.univ-angers.fr</code></pre></div></div></div><div class="sect3"><h4 id="_le_module_requests"><a class="anchor" href="#_le_module_requests"></a>Le module <code>requests</code></h4><div class="paragraph"><p>Le module Python <code>requests</code> dispose de fonctions (get, post, etc.) implémentant chaque méthode HTTP.</p></div><div class="listingblock"><div class="title">exemple</div><div class="content"><pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python">response = requests.get('http://math.univ-angers.fr')</code></pre></div></div><div class="paragraph"><p>Ces fonctions renvoient un objet réponse composé d&#8217;attributs<code>status_code</code>, <code>headers</code>, <code>content-type</code>, <code>encoding</code> et <code>text</code>.</p></div><div class="sidebarblock exercice"><div class="content"><div class="title">Exercice 1</div><div class="paragraph"><div class="title">Question 1</div><p>Ecrire une fonction <code>fetch</code> ayant 2 paramètres (une URL et un entier id), qui récupère la ressource située à l&#8217;URL fournie, et qui écrit à l&#8217;écran une ligne contenant dans cet ordre <code>id</code>, le code de retour HTTP, le nombre d&#8217;octets récupérés et le temps pris par la requête.</p></div><div class="paragraph"><div class="title">Question 2</div><p>Définir une liste d&#8217;URL ainsi qu&#8217;une constante n, puisappeler <code>fetch</code> n fois pour chaque URL (<code>id</code> sera un n° séquentiel d&#8217;appel).</p></div><div class="admonitionblock warning"><table><tr><td class="icon"><i class="fa icon-warning" title="Warning"></i></td><td class="content">Choisir des URL qui ne déclencheront pas d&#8217;incident diplomatique :<a href="https://math.univ-angers.fr" class="bare">https://math.univ-angers.fr</a>,<a href="http://www.univ-angers.fr" class="bare">http://www.univ-angers.fr</a>,<a href="http://httpbin.org/get" class="bare">http://httpbin.org/get</a></td></tr></table></div><div class="paragraph"><div class="title">Question 3</div><p>Faire le cumul des temps mesurés, calculer le temps global d&#8217;exécution du programme, et afficher ces 2 valeurs en fin de programme.Conclusion ?</p></div></div></div><div class="paragraph"><p>Le module <code>aiohttp</code> offre des coroutines pour faire la même chose.En minimisant les temps d&#8217;attente,il permet de réaliser des programmes requeteurs dont le temps d&#8217;exécution est inférieur à la somme des temps d&#8217;exécution des requêtes.</p></div></div></div><div class="sect2"><h3 id="https"><a class="anchor" href="#https"></a>Le protocole HTTPS</h3><div class="paragraph"><p>D&#8217;un point de vue sécurité, HTTP a 2 faiblesses :</p></div><div class="olist arabic"><ol class="arabic"><li><p>les données échangées passent en clair sur le réseau,donc peuvent être écoutées, voire modifiées (<em>man in the middle</em>),</p></li><li><p>rien ne garantit que le serveur qui répond est le <em>bon</em> serveur (<em>phishing</em>).</p></li></ol></div><div class="paragraph"><p>Le protocole HTTPS pallie à ces 2 défaut en :</p></div><div class="olist arabic"><ol class="arabic"><li><p>chiffrant les échanges</p></li><li><p>authentifiant le serveur accédé.</p></li></ol></div><div class="paragraph"><p>Techniquement, HTTPS est l&#8217;empilement de 2 protocoles : TLS (protocole de sécurisation) et HTTP.</p></div><div class="paragraph"><p>L&#8217;authentification repose sur un certificat, déposé sur le serveur, et vérifié par le client à la connexion.Le certificat est signé par une autorité de confiance.Il a une durée de validité limitée.Il est la preuve que l&#8217;autorité a validé, à une date donnée, ce serveur comme étant bien celui qui doit répondre à l&#8217;URL en question.</p></div><div class="paragraph"><p>En suppposant qu&#8217;il n&#8217;y ait pas de brebis galeuse chez les autorités de confiance, il est donc impossible qu&#8217;un faux serveur présentant un certificat valide se fasse passer pour un autre.</p></div><div class="listingblock"><div class="title">exemple de vérification de l&#8217;authenticité d&#8217;un serveur avec <code>requests</code></div><div class="content"><pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python">response = requests.get('https://math.univ-angers.fr', verify=True)</code></pre></div></div></div><div class="sect2"><h3 id="servicesweb"><a class="anchor" href="#servicesweb"></a>Services web</h3><div class="paragraph"><p>Le web est un ensemble de ressources accessible via HTTP.A l&#8217;origine, ces ressources étaient des documents (pages, images, video).Aujourd&#8217;hui, des données de tout format (XML, JSON, etc) sont accessibles de la même façon.</p></div><div class="sidebarblock exercice"><div class="content"><div class="title">Exercice 2</div>Interroger, via le module <code>requests</code>, les services web de <a href="https://jsonplaceholder.typicode.com" class="bare">https://jsonplaceholder.typicode.com</a>, et décoder ces données.</div></div></div></div></div></article>  </main></div><footer class="footer">  <p>Master Data Science de l'Université d'Angers --      Jacquelin Charbonnel       © Copyright 2017-2020   </p></footer><script src="../../../_/js/site.js"></script><script src="../../../_/js/vendor/highlight.js"></script><script>hljs.initHighlighting()</script>  </body></html>